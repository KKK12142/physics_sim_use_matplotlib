# manim-iterative: 물리 애니메이션 반복 개발 워크플로우

## 목적

Manim을 사용한 물리 교육 애니메이션의 **설계 → 구현 → 피드백 반영** 전체 워크플로우를 가이드한다.

---

## 워크플로우 4단계

### A. 설계

1. 주제와 교육목표를 확인한다
2. 씬을 단계별로 분해한다: `intro → derivation → sim_A → sim_B → comparison → outro`
3. 각 단계에서 보여줄 물리량과 시각 요소를 나열한다

### B. 물리모델

1. 주제에 맞는 물리 모델을 선택한다 → `references/physics-models.md` 참고
2. `_make_experiment()` 딕셔너리 패턴으로 파라미터를 사전 계산한다
3. 모든 도출량(F_peak, F_avg, t_coll_end 등)을 한 번만 계산하여 딕셔너리에 저장한다

### C. 구현

1. `references/` 의 패턴을 참고하여 코드를 작성한다:
   - 씬 구조 → `scene-architecture.md`
   - 그래프 설정 → `graph-patterns.md`
   - 애니메이션 → `animation-recipes.md`
   - 한글/교육 → `korean-education.md`
2. **렌더링 전 체크리스트**를 검증한 후 코드를 제시한다

### D. 피드백 반영

1. 피드백을 아래 **피드백 분류표**로 분류한다
2. 해당 유형의 대응 방법에 따라 타겟 수정한다
3. 수정 후 다시 체크리스트를 검증한다

---

## 렌더링 전 체크리스트

- [ ] v-t 그래프가 F/m 의 적분과 일치하는가 (물리적 일관성)
- [ ] F-t 그래프가 충돌 시작/끝에서 정확히 0인가
- [ ] ValueTracker updater는 애니메이션 후 반드시 `clear_updaters()` 호출
- [ ] `always_redraw` 클로저에서 변수 캡처가 올바른가 (루프 변수 주의)
- [ ] 축 범위가 peak 값의 1.15~1.25배인가
- [ ] 한글 텍스트 → `Text()`, 수식 → `MathTex()` 구분
- [ ] 색상 컨벤션 준수: 힘=RED, 속도=GREEN/BLUE, 결과=YELLOW
- [ ] F-t 면적(충격량) 수치가 계산값과 일치하는가
- [ ] 그래프의 커스텀 틱/라벨이 물리량과 일치하는가
- [ ] 인트로/아웃트로 패턴 포함 여부

---

## 피드백 분류표

| 유형 | 예시 | 대응 |
|------|------|------|
| **그래프 형태** | "F-t가 0에서 시작해야" | 모델 함수의 경계조건 확인. `_f_spring(tau, dt)`에서 `tau<=0` 분기 점검 |
| **애니메이션 흐름** | "카메라 줌 제거", "너무 빠름" | `self.play()` 추가/제거, `run_time` 조정 |
| **레이아웃** | "그래프 왼쪽으로" | `move_to()` 좌표 조정, `to_corner()` 변경 |
| **물리 정확성** | "v-t가 F-t와 안 맞아" | F/m 적분으로 v 재도출, 모델 수식 검증 |
| **텍스트/라벨** | "폰트 키워", "단위 빠짐" | `font_size` 조정, 라벨 텍스트 수정 |
| **색상/스타일** | "구분이 안 됨" | 색상 컨벤션 재적용, `stroke_width` 조정 |

---

## 색상 컨벤션

| 물리량 | 색상 | 용도 |
|--------|------|------|
| 힘 (F) | `RED` | F-t 곡선, 힘 화살표 |
| 속도 (v) | `GREEN` / `BLUE` | v-t 곡선, 속도 라벨 |
| 물체 A | `BLUE` | 박스, 운동량 그래프 |
| 물체 B | `RED` | 박스, 운동량 그래프 |
| 결과/강조 | `YELLOW` | 결론 수식, 충격량 결과, SurroundingRectangle |
| 평균힘 | `ORANGE` | 평균힘 점선, 라벨 |
| 보조선 | `GRAY` | 점선 참조선 |
| 합체 물체 | `PURPLE` | 비탄성 충돌 후 합체 |
| 부드러운 바닥 | `TEAL` | 실험 B 바닥/곡선 |

---

## 코드 컨벤션

- 클래스 상수: `MASS`, `G`, `V_IMPACT = G * T_FALL` 등을 클래스 레벨에 정의
- 실험 파라미터: `_make_experiment()` → `dict` 패턴으로 중앙 관리
- 씬 구조: `construct()` → phase 메서드 호출, `clear_screen()` 으로 구분
- 그래프 축: `x_range`, `y_range` 에 물리적 범위 반영, `numbers_to_include`로 핵심값 표시
- updater 해제: 애니메이션 종료 후 반드시 `obj.clear_updaters()` → 위치 고정 → 정적 객체로 교체
